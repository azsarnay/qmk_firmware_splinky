
/*
 * Copyright 2021 Quentin LEBASTARD <qlebastard@gmail.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

// #include QMK_KEYBOARD_H
#include "azsarnay.h"
#include QMK_KEYBOARD_H
// #define hand_swap_config

// #ifdef RGBLIGHT_ENABLE
// //Following line allows macro to read current RGB settings
// extern rgblight_config_t rgblight_config;
// #endif

// extern uint8_t is_master;z


#define LAYOUT_charybdis_3x5_wrapper(...) LAYOUT_charybdis_3x5(__VA_ARGS__)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

  [_COLEMAK] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      ______________COLEMAK_MOD_DH_L1_HRMod______,                     ______________COLEMAK_MOD_DH_R1_HRMod______,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ______________COLEMAK_MOD_DH_L2____________,                     ________COLEMAK_MOD_DH_R2_CHARYBDIS________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ______________COLEMAK_MOD_DH_L3____________,                     ______________COLEMAK_MOD_DH_R3____________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
               _____________BASE_LEFT_THUMB_______________,   _____________BASE_RIGHT_THUMB_CHARYBDIS____
                             //`--------------------------'  `--------------------------'

  ),

    [_GAME] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      ___________________GAME_L1_________________,                      ___________________GAME_R1_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________GAME_L2_________________,                      ___________________GAME_R2_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________GAME_L3_________________,                      ___________________GAME_R3_________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
              ___________________GAME_LT_________________,    ___________________GAME_RT_________________
                            //`--------------------------'   `--------------------------'
),

  [_GAMEL2] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      ___________________GAMEL2_L1_______________,                      ___________________GAMEL2_R1_______________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________GAMEL2_L2_______________,                      ___________________GAMEL2_R2_______________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________GAMEL2_L3_______________,                      ___________________GAMEL2_R3_______________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
              ___________________GAMEL2_LT_______________,    ___________________GAMEL2_RT_______________
                            //`--------------------------'   `--------------------------'
),


 [_MMO] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      ___________________MMO_L1__________________,                      ___________________MMO_R1__________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________MMO_L2__________________,                      ___________________MMO_R2__________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________MMO_L3__________________,                      ___________________MMO_R3__________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
              ___________________MMO_LT__________________,    ___________________MMO_RT__________________
                            //`--------------------------'   `--------------------------'
),

  [_MMOL2] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      ___________________MMOL2_L1________________,                      ___________________MMOL2_R1________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________MMOL2_L2________________,                      ___________________MMOL2_R2________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      ___________________MMOL2_L3________________,                      ___________________MMOL2_R3________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
               ___________________MMOL2_LT________________,    ___________________MMOL2_RT________________
                            //`--------------------------'   `--------------------------'
),


//   [_DESTINY] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       _________________DESTINY_L1________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________DESTINY_L2________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________DESTINY_L3________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//               _________________DESTINY_LT________________,    XXXXXXX, COLEMAK, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),

//   [_DESTINYL2] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       _________________DESTINYL2_L1______________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________DESTINYL2_L2______________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________DESTINYL2_L3______________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//                                 XXXXXXX, XXXXXXX, XXXXXXX,    XXXXXXX, XXXXXXX, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),

//     [_COD] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       _________________COD_L1____________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________COD_L2____________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________COD_L3____________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//               _________________COD_LT____________________,    XXXXXXX, COLEMAK, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),

//   [_CODL2] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       _________________CODL2_L1__________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________CODL2_L2__________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________CODL2_L3__________________,                      _________________EMPTY_____________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//                                 XXXXXXX, XXXXXXX, XXXXXXX,    XXXXXXX, COLEMAK, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),


  [_NAVNUM] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      _________________NAVNUM_L1_________________,                      _________________NAVNUM_R1_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________NAVNUM_L2_________________,                      _________________NAVNUM_R2_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________NAVNUM_L3_________________,                      _________________NAVNUM_R3_________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
                                KC_NO,    KC_NO,    KC_NO,     LALT_T(KC_EQL), KC_0
                            //`--------------------------'   `--------------------------'
),

  [_SYM] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      _________________SYM_L1____________________,                      _________________SYM_R1____________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________SYM_L2____________________,                      _________________SYM_R2____________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________SYM_L3____________________,                      _________________SYM_R3____________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
                               KC_LGUI,  MCRO,   KC_LSFT,     MCRO,    MCRO
                            //`--------------------------'   `--------------------------'
),

  [_BROWSER] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      _________________BROWSER_L1________________,                      _________________ADJUST_R1_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________BROWSER_L2________________,                      _________________ADJUST_R2_________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________BROWSER_L3________________,                      _________________ADJUST_R3_________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
                               KC_NO,    KC_NO,    KC_NO,      MCRO,    MCRO
                            //`--------------------------'   `--------------------------'
),


  [_MCRO] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      _________________MCRO_L1___________________,                      _________________MCRO_R1___________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________MCRO_L2___________________,                      _________________MCRO_R2___________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________MCRO_L3___________________,                      _________________MCRO_R3___________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
                               KC_NO,    KC_NO,    KC_NO,      KC_NO,    KC_NO
                            //`--------------------------'   `--------------------------'
),

  [_POINTER] = LAYOUT_charybdis_3x5_wrapper(
  //,--------------------------------------------.                    ,--------------------------------------------.
      _________________POINTER_L1________________,                      _________________POINTER_R1________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________POINTER_L2________________,                      _________________POINTER_R2________________,
  //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
      _________________POINTER_L3________________,                      _________________POINTER_R3________________,
  //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
                                KC_BTN2, KC_BTN1, KC_BTN3,    XXXXXXX, MOUSEP
                            //`--------------------------'   `--------------------------'
),

//   [_MOUSEP] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       __________________MOUSE_L1_________________,                      __________________MOUSE_R1_________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       __________________MOUSE_L2_________________,                      __________________MOUSE_R2_________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       __________________MOUSE_L3_________________,                      __________________MOUSE_R3_________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//                                 KC_BTN2, KC_BTN1, KC_BTN3,    XXXXXXX, COLEMAK, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),


//   [_BROWSER] = LAYOUT_split_3x5_3_wrapper(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       _________________BROWSER_L1________________,                      _________________BROWSER_R1________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________BROWSER_L2________________,                      _________________BROWSER_R2________________,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       _________________BROWSER_L3________________,                      _________________BROWSER_R3________________,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//                                KC_NO,    KC_NO,    KC_NO,      KC_NO,    KC_NO,    KC_NO
//                             //`--------------------------'   `--------------------------'
// ),




//   [_TEMPLATE] = LAYOUT_split_3x5_3(
//   //,--------------------------------------------.                    ,--------------------------------------------.
//       XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
//   //|--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------|
//       XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
//   //|--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------|
//                                 XXXXXXX, XXXXXXX, XXXXXXX,    XXXXXXX, XXXXXXX, XXXXXXX
//                             //`--------------------------'   `--------------------------'
// ),


};



#ifdef POINTING_DEVICE_ENABLE
#    ifdef CHARYBDIS_AUTO_POINTER_LAYER_TRIGGER_ENABLE
report_mouse_t pointing_device_task_user(report_mouse_t mouse_report) {
    if (abs(mouse_report.x) > CHARYBDIS_AUTO_POINTER_LAYER_TRIGGER_THRESHOLD || abs(mouse_report.y) > CHARYBDIS_AUTO_POINTER_LAYER_TRIGGER_THRESHOLD) {
        if (auto_pointer_layer_timer == 0) {
            layer_on(LAYER_POINTER);
#        ifdef RGB_MATRIX_ENABLE
            rgb_matrix_mode_noeeprom(RGB_MATRIX_NONE);
            rgb_matrix_sethsv_noeeprom(HSV_GREEN);
#        endif  // RGB_MATRIX_ENABLE
        }
        auto_pointer_layer_timer = timer_read();
    }
    return mouse_report;
}

void matrix_scan_kb(void) {
    if (auto_pointer_layer_timer != 0 && TIMER_DIFF_16(timer_read(), auto_pointer_layer_timer) >= CHARYBDIS_AUTO_POINTER_LAYER_TRIGGER_TIMEOUT_MS) {
        auto_pointer_layer_timer = 0;
        layer_off(LAYER_POINTER);
#        ifdef RGB_MATRIX_ENABLE
        rgb_matrix_mode_noeeprom(RGB_MATRIX_STARTUP_MODE);
#        endif  // RGB_MATRIX_ENABLE
    }
    matrix_scan_user();
}
#    endif  // CHARYBDIS_AUTO_POINTER_LAYER_TRIGGER_ENABLE

#    ifdef CHARYBDIS_AUTO_SNIPING_ON_LAYER
layer_state_t layer_state_set_kb(layer_state_t state) {
    state = layer_state_set_user(state);
    charybdis_set_pointer_sniping_enabled(layer_state_cmp(state, CHARYBDIS_AUTO_SNIPING_ON_LAYER));
    return state;
}
#    endif  // CHARYBDIS_AUTO_SNIPING_ON_LAYER
#endif      // POINTING_DEVICE_ENABLE

#ifdef RGB_MATRIX_ENABLE
// Forward-declare this helper function since it is defined in rgb_matrix.c.
void rgb_matrix_update_pwm_buffers(void);
#endif


uint16_t get_tapping_term(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case LT(_POINTER, KC_E):
            return TAPPING_TERM + 300;
        case LT(_MMOL2,KC_SPC):
            return TAPPING_TERM + 100;
        default:
            return TAPPING_TERM;
    }
}




// int RGB_current_mode;

// void matrix_init_user(void) {
//     #ifdef RGBLIGHT_ENABLE
//       RGB_current_mode = rgblight_config.mode;
//     #endif
// }

// int RGB_current_mode;

// void persistent_default_layer_set(uint16_t default_layer) {
//   eeconfig_update_default_layer(default_layer);
//   default_layer_set(default_layer);
// }

// // Setting ADJUST layer RGB back to default
// void update_tri_layer_RGB(uint8_t layer1, uint8_t layer2, uint8_t layer3) {
//   if (IS_LAYER_ON(layer1) && IS_LAYER_ON(layer2)) {
//     layer_on(layer3);
//   } else {
//     layer_off(layer3);
//   }
// }

// void matrix_init_user(void) {
//     #ifdef RGBLIGHT_ENABLE
//       RGB_current_mode = rgblight_config.mode;
//     #endif
// }

// bool process_record_user(uint16_t keycode, keyrecord_t *record) {
//   // report_mouse_t currentReport = {};
//   switch (keycode) {
//     case COLEMAK:
//       if (record->event.pressed) {
//         persistent_default_layer_set(1UL<<_COLEMAK);
//       }
//       return false;
    // case LOWER:
    //   if (record->event.pressed) {
    //     layer_on(_LOWER);
    //     update_tri_layer_RGB(_LOWER, _RAISE, _ADJUST);
    //   } else {
    //     layer_off(_LOWER);
    //     update_tri_layer_RGB(_LOWER, _RAISE, _ADJUST);
    //   }
    //   return false;
    // case RAISE:
    //   if (record->event.pressed) {
    //     layer_on(_RAISE);
    //     update_tri_layer_RGB(_LOWER, _RAISE, _ADJUST);
    //   } else {
    //     layer_off(_RAISE);
    //     update_tri_layer_RGB(_LOWER, _RAISE, _ADJUST);
    //   }
    //   return false;
    // case RGB_MOD:
    //   #ifdef RGBLIGHT_ENABLE
    //     if (record->event.pressed) {
    //       rgblight_mode(RGB_current_mode);
    //       rgblight_step();
    //       RGB_current_mode = rgblight_config.mode;
    //     }
    //   #endif
    //   return false;
    // case RGBRST:
    //   #ifdef RGBLIGHT_ENABLE
    //     if (record->event.pressed) {
    //       eeconfig_update_rgblight_default();
    //       rgblight_enable();
    //       RGB_current_mode = rgblight_config.mode;
    //     }
    //   #endif
    //   break;
    // case MBTN1:
    //   currentReport = pointing_device_get_report();
    //   if (record->event.pressed) {
    //     currentReport.buttons |= MOUSE_BTN1;
    //   }
    //   else {
    //     currentReport.buttons &= ~MOUSE_BTN1;
    //   }
    //   pointing_device_set_report(currentReport);
    //   pointing_device_send();
    //   return false;
    // case SCRL:
    //   if (record->event.pressed) {
    //     isScrollMode = true;
    //   }
    //   else {
    //     isScrollMode = false;
    //   }
    //   return false;
//   }
//   return true;
//


